\hypertarget{stb__image__write_8h_source}{}\doxysection{stb\+\_\+image\+\_\+write.\+h}
\label{stb__image__write_8h_source}\index{source/Rendering/SOIL2/stb\_image\_write.h@{source/Rendering/SOIL2/stb\_image\_write.h}}
\mbox{\hyperlink{stb__image__write_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* stb\_image\_write -\/ v1.00 -\/ public domain -\/ http://nothings.org/stb/stb\_image\_write.h}}
\DoxyCodeLine{2 \textcolor{comment}{   writes out PNG/BMP/TGA images to C stdio -\/ Sean Barrett 2010-\/2015}}
\DoxyCodeLine{3 \textcolor{comment}{                                     no warranty implied; use at your own risk}}
\DoxyCodeLine{4 \textcolor{comment}{}}
\DoxyCodeLine{5 \textcolor{comment}{   Before \#including,}}
\DoxyCodeLine{6 \textcolor{comment}{}}
\DoxyCodeLine{7 \textcolor{comment}{       \#define STB\_IMAGE\_WRITE\_IMPLEMENTATION}}
\DoxyCodeLine{8 \textcolor{comment}{}}
\DoxyCodeLine{9 \textcolor{comment}{   in the file that you want to have the implementation.}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   Will probably not work correctly with strict-\/aliasing optimizations.}}
\DoxyCodeLine{12 \textcolor{comment}{}}
\DoxyCodeLine{13 \textcolor{comment}{ABOUT:}}
\DoxyCodeLine{14 \textcolor{comment}{}}
\DoxyCodeLine{15 \textcolor{comment}{   This header file is a library for writing images to C stdio. It could be}}
\DoxyCodeLine{16 \textcolor{comment}{   adapted to write to memory or a general streaming interface; let me know.}}
\DoxyCodeLine{17 \textcolor{comment}{}}
\DoxyCodeLine{18 \textcolor{comment}{   The PNG output is not optimal; it is 20-\/50\% larger than the file}}
\DoxyCodeLine{19 \textcolor{comment}{   written by a decent optimizing implementation. This library is designed}}
\DoxyCodeLine{20 \textcolor{comment}{   for source code compactness and simplicity, not optimal image file size}}
\DoxyCodeLine{21 \textcolor{comment}{   or run-\/time performance.}}
\DoxyCodeLine{22 \textcolor{comment}{}}
\DoxyCodeLine{23 \textcolor{comment}{BUILDING:}}
\DoxyCodeLine{24 \textcolor{comment}{}}
\DoxyCodeLine{25 \textcolor{comment}{   You can \#define STBIW\_ASSERT(x) before the \#include to avoid using assert.h.}}
\DoxyCodeLine{26 \textcolor{comment}{   You can \#define STBIW\_MALLOC(), STBIW\_REALLOC(), and STBIW\_FREE() to replace}}
\DoxyCodeLine{27 \textcolor{comment}{   malloc,realloc,free.}}
\DoxyCodeLine{28 \textcolor{comment}{   You can define STBIW\_MEMMOVE() to replace memmove()}}
\DoxyCodeLine{29 \textcolor{comment}{}}
\DoxyCodeLine{30 \textcolor{comment}{USAGE:}}
\DoxyCodeLine{31 \textcolor{comment}{}}
\DoxyCodeLine{32 \textcolor{comment}{   There are four functions, one for each image file format:}}
\DoxyCodeLine{33 \textcolor{comment}{}}
\DoxyCodeLine{34 \textcolor{comment}{     int stbi\_write\_png(char const *filename, int w, int h, int comp, const void *data, int stride\_in\_bytes);}}
\DoxyCodeLine{35 \textcolor{comment}{     int stbi\_write\_bmp(char const *filename, int w, int h, int comp, const void *data);}}
\DoxyCodeLine{36 \textcolor{comment}{     int stbi\_write\_tga(char const *filename, int w, int h, int comp, const void *data);}}
\DoxyCodeLine{37 \textcolor{comment}{     int stbi\_write\_hdr(char const *filename, int w, int h, int comp, const void *data);}}
\DoxyCodeLine{38 \textcolor{comment}{}}
\DoxyCodeLine{39 \textcolor{comment}{   There are also four equivalent functions that use an arbitrary write function. You are}}
\DoxyCodeLine{40 \textcolor{comment}{   expected to open/close your file-\/equivalent before and after calling these:}}
\DoxyCodeLine{41 \textcolor{comment}{}}
\DoxyCodeLine{42 \textcolor{comment}{     int stbi\_write\_png\_to\_func(stbi\_write\_func *func, void *context, int w, int h, int comp, const void  *data, int stride\_in\_bytes);}}
\DoxyCodeLine{43 \textcolor{comment}{     int stbi\_write\_bmp\_to\_func(stbi\_write\_func *func, void *context, int w, int h, int comp, const void  *data);}}
\DoxyCodeLine{44 \textcolor{comment}{     int stbi\_write\_tga\_to\_func(stbi\_write\_func *func, void *context, int w, int h, int comp, const void  *data);}}
\DoxyCodeLine{45 \textcolor{comment}{     int stbi\_write\_hdr\_to\_func(stbi\_write\_func *func, void *context, int w, int h, int comp, const float *data);}}
\DoxyCodeLine{46 \textcolor{comment}{}}
\DoxyCodeLine{47 \textcolor{comment}{   where the callback is:}}
\DoxyCodeLine{48 \textcolor{comment}{      void stbi\_write\_func(void *context, void *data, int size);}}
\DoxyCodeLine{49 \textcolor{comment}{}}
\DoxyCodeLine{50 \textcolor{comment}{   You can define STBI\_WRITE\_NO\_STDIO to disable the file variant of these}}
\DoxyCodeLine{51 \textcolor{comment}{   functions, so the library will not use stdio.h at all. However, this will}}
\DoxyCodeLine{52 \textcolor{comment}{   also disable HDR writing, because it requires stdio for formatted output.}}
\DoxyCodeLine{53 \textcolor{comment}{}}
\DoxyCodeLine{54 \textcolor{comment}{   Each function returns 0 on failure and non-\/0 on success.}}
\DoxyCodeLine{55 \textcolor{comment}{}}
\DoxyCodeLine{56 \textcolor{comment}{   The functions create an image file defined by the parameters. The image}}
\DoxyCodeLine{57 \textcolor{comment}{   is a rectangle of pixels stored from left-\/to-\/right, top-\/to-\/bottom.}}
\DoxyCodeLine{58 \textcolor{comment}{   Each pixel contains 'comp' channels of data stored interleaved with 8-\/bits}}
\DoxyCodeLine{59 \textcolor{comment}{   per channel, in the following order: 1=Y, 2=YA, 3=RGB, 4=RGBA. (Y is}}
\DoxyCodeLine{60 \textcolor{comment}{   monochrome color.) The rectangle is 'w' pixels wide and 'h' pixels tall.}}
\DoxyCodeLine{61 \textcolor{comment}{   The *data pointer points to the first byte of the top-\/left-\/most pixel.}}
\DoxyCodeLine{62 \textcolor{comment}{   For PNG, "{}stride\_in\_bytes"{} is the distance in bytes from the first byte of}}
\DoxyCodeLine{63 \textcolor{comment}{   a row of pixels to the first byte of the next row of pixels.}}
\DoxyCodeLine{64 \textcolor{comment}{}}
\DoxyCodeLine{65 \textcolor{comment}{   PNG creates output files with the same number of components as the input.}}
\DoxyCodeLine{66 \textcolor{comment}{   The BMP format expands Y to RGB in the file format and does not}}
\DoxyCodeLine{67 \textcolor{comment}{   output alpha.}}
\DoxyCodeLine{68 \textcolor{comment}{}}
\DoxyCodeLine{69 \textcolor{comment}{   PNG supports writing rectangles of data even when the bytes storing rows of}}
\DoxyCodeLine{70 \textcolor{comment}{   data are not consecutive in memory (e.g. sub-\/rectangles of a larger image),}}
\DoxyCodeLine{71 \textcolor{comment}{   by supplying the stride between the beginning of adjacent rows. The other}}
\DoxyCodeLine{72 \textcolor{comment}{   formats do not. (Thus you cannot write a native-\/format BMP through the BMP}}
\DoxyCodeLine{73 \textcolor{comment}{   writer, both because it is in BGR order and because it may have padding}}
\DoxyCodeLine{74 \textcolor{comment}{   at the end of the line.)}}
\DoxyCodeLine{75 \textcolor{comment}{}}
\DoxyCodeLine{76 \textcolor{comment}{   HDR expects linear float data. Since the format is always 32-\/bit rgb(e)}}
\DoxyCodeLine{77 \textcolor{comment}{   data, alpha (if provided) is discarded, and for monochrome data it is}}
\DoxyCodeLine{78 \textcolor{comment}{   replicated across all three channels.}}
\DoxyCodeLine{79 \textcolor{comment}{}}
\DoxyCodeLine{80 \textcolor{comment}{   TGA supports RLE or non-\/RLE compressed data. To use non-\/RLE-\/compressed}}
\DoxyCodeLine{81 \textcolor{comment}{   data, set the global variable 'stbi\_write\_tga\_with\_rle' to 0.}}
\DoxyCodeLine{82 \textcolor{comment}{}}
\DoxyCodeLine{83 \textcolor{comment}{CREDITS:}}
\DoxyCodeLine{84 \textcolor{comment}{}}
\DoxyCodeLine{85 \textcolor{comment}{   PNG/BMP/TGA}}
\DoxyCodeLine{86 \textcolor{comment}{      Sean Barrett}}
\DoxyCodeLine{87 \textcolor{comment}{   HDR}}
\DoxyCodeLine{88 \textcolor{comment}{      Baldur Karlsson}}
\DoxyCodeLine{89 \textcolor{comment}{   TGA monochrome:}}
\DoxyCodeLine{90 \textcolor{comment}{      Jean-\/Sebastien Guay}}
\DoxyCodeLine{91 \textcolor{comment}{   misc enhancements:}}
\DoxyCodeLine{92 \textcolor{comment}{      Tim Kelsey}}
\DoxyCodeLine{93 \textcolor{comment}{   TGA RLE}}
\DoxyCodeLine{94 \textcolor{comment}{      Alan Hickman}}
\DoxyCodeLine{95 \textcolor{comment}{   initial file IO callback implementation}}
\DoxyCodeLine{96 \textcolor{comment}{      Emmanuel Julien}}
\DoxyCodeLine{97 \textcolor{comment}{   bugfixes:}}
\DoxyCodeLine{98 \textcolor{comment}{      github:Chribba}}
\DoxyCodeLine{99 \textcolor{comment}{      Guillaume Chereau}}
\DoxyCodeLine{100 \textcolor{comment}{      github:jry2}}
\DoxyCodeLine{101 \textcolor{comment}{      }}
\DoxyCodeLine{102 \textcolor{comment}{LICENSE}}
\DoxyCodeLine{103 \textcolor{comment}{}}
\DoxyCodeLine{104 \textcolor{comment}{This software is in the public domain. Where that dedication is not}}
\DoxyCodeLine{105 \textcolor{comment}{recognized, you are granted a perpetual, irrevocable license to copy,}}
\DoxyCodeLine{106 \textcolor{comment}{distribute, and modify this file as you see fit.      }}
\DoxyCodeLine{107 \textcolor{comment}{}}
\DoxyCodeLine{108 \textcolor{comment}{*/}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110 \textcolor{preprocessor}{\#ifndef INCLUDE\_STB\_IMAGE\_WRITE\_H}}
\DoxyCodeLine{111 \textcolor{preprocessor}{\#define INCLUDE\_STB\_IMAGE\_WRITE\_H}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{114 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{115 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{preprocessor}{\#ifdef STB\_IMAGE\_WRITE\_STATIC}}
\DoxyCodeLine{118 \textcolor{preprocessor}{\#define STBIWDEF static}}
\DoxyCodeLine{119 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{120 \textcolor{preprocessor}{\#define STBIWDEF extern}}
\DoxyCodeLine{121 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a7aa69838d830bd1e917b2a20d2030e0c}{stbi\_write\_tga\_with\_rle}};}
\DoxyCodeLine{122 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{125 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a9c03e5171f6aea47fde6dafcf3249ccf}{stbi\_write\_png}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void}  *data, \textcolor{keywordtype}{int} stride\_in\_bytes);}
\DoxyCodeLine{126 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a4f63ec842984e5db3edf2da89f16038e}{stbi\_write\_bmp}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void}  *data);}
\DoxyCodeLine{127 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_ab7a84427c6d7e894090fbeae3bc8f6da}{stbi\_write\_tga}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void}  *data);}
\DoxyCodeLine{128 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a21f22be0194761e08b682ed543ef6161}{stbi\_write\_hdr}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{float} *data);}
\DoxyCodeLine{129 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{keyword}{typedef} \textcolor{keywordtype}{void} \mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}}(\textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} size);}
\DoxyCodeLine{132 }
\DoxyCodeLine{133 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a72dcd18698d64c92082449912c39a4e5}{stbi\_write\_png\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void}  *data, \textcolor{keywordtype}{int} stride\_in\_bytes);}
\DoxyCodeLine{134 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_aca9573665994b2244a6a045b2a1df1ea}{stbi\_write\_bmp\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void}  *data);}
\DoxyCodeLine{135 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a5e5c6483c1d45a65fe208f52937cd315}{stbi\_write\_tga\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void}  *data);}
\DoxyCodeLine{136 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_ac9214f775162b61a3503c76875966c11}{stbi\_write\_hdr\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} w, \textcolor{keywordtype}{int} h, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{float} *data);}
\DoxyCodeLine{137 }
\DoxyCodeLine{138 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{139 \}}
\DoxyCodeLine{140 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142 \textcolor{preprocessor}{\#endif}\textcolor{comment}{//INCLUDE\_STB\_IMAGE\_WRITE\_H}}
\DoxyCodeLine{143 }
\DoxyCodeLine{144 \textcolor{preprocessor}{\#ifdef STB\_IMAGE\_WRITE\_IMPLEMENTATION}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{147 \textcolor{preprocessor}{   \#define \_CRT\_SECURE\_NO\_WARNINGS}}
\DoxyCodeLine{148 \textcolor{preprocessor}{   \#define \_CRT\_NONSTDC\_NO\_DEPRECATE}}
\DoxyCodeLine{149 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{152 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{153 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{154 }
\DoxyCodeLine{155 \textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{156 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{157 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{158 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{159 }
\DoxyCodeLine{160 \textcolor{preprocessor}{\#if defined(STBIW\_MALLOC) \&\& defined(STBIW\_FREE) \&\& defined(STBIW\_REALLOC)}}
\DoxyCodeLine{161 \textcolor{comment}{// ok}}
\DoxyCodeLine{162 \textcolor{preprocessor}{\#elif !defined(STBIW\_MALLOC) \&\& !defined(STBIW\_FREE) \&\& !defined(STBIW\_REALLOC)}}
\DoxyCodeLine{163 \textcolor{comment}{// ok}}
\DoxyCodeLine{164 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{165 \textcolor{preprocessor}{\#error "{}Must define all or none of STBIW\_MALLOC, STBIW\_FREE, and STBIW\_REALLOC."{}}}
\DoxyCodeLine{166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{preprocessor}{\#ifndef STBIW\_MALLOC}}
\DoxyCodeLine{169 \textcolor{preprocessor}{\#define STBIW\_MALLOC(sz)    malloc(sz)}}
\DoxyCodeLine{170 \textcolor{preprocessor}{\#define STBIW\_REALLOC(p,sz) realloc(p,sz)}}
\DoxyCodeLine{171 \textcolor{preprocessor}{\#define STBIW\_FREE(p)       free(p)}}
\DoxyCodeLine{172 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{173 \textcolor{preprocessor}{\#ifndef STBIW\_MEMMOVE}}
\DoxyCodeLine{174 \textcolor{preprocessor}{\#define STBIW\_MEMMOVE(a,b,sz) memmove(a,b,sz)}}
\DoxyCodeLine{175 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 }
\DoxyCodeLine{178 \textcolor{preprocessor}{\#ifndef STBIW\_ASSERT}}
\DoxyCodeLine{179 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{180 \textcolor{preprocessor}{\#define STBIW\_ASSERT(x) assert(x)}}
\DoxyCodeLine{181 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{184 \{}
\DoxyCodeLine{185    \mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func;}
\DoxyCodeLine{186    \textcolor{keywordtype}{void} *context;}
\DoxyCodeLine{187 \} stbi\_\_write\_context;}
\DoxyCodeLine{188 }
\DoxyCodeLine{189 \textcolor{comment}{// initialize a callback-\/based context}}
\DoxyCodeLine{190 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbi\_\_start\_write\_callbacks(stbi\_\_write\_context *s, \mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *c, \textcolor{keywordtype}{void} *context)}
\DoxyCodeLine{191 \{}
\DoxyCodeLine{192    s-\/>func    = c;}
\DoxyCodeLine{193    s-\/>context = context;}
\DoxyCodeLine{194 \}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbi\_\_stdio\_write(\textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} size)}
\DoxyCodeLine{199 \{}
\DoxyCodeLine{200    fwrite(data,1,size,(FILE*) context);}
\DoxyCodeLine{201 \}}
\DoxyCodeLine{202 }
\DoxyCodeLine{203 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stbi\_\_start\_write\_file(stbi\_\_write\_context *s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *filename)}
\DoxyCodeLine{204 \{}
\DoxyCodeLine{205    FILE *f = fopen(filename, \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{206    stbi\_\_start\_write\_callbacks(s, stbi\_\_stdio\_write, (\textcolor{keywordtype}{void} *) f);}
\DoxyCodeLine{207    \textcolor{keywordflow}{return} f != NULL;}
\DoxyCodeLine{208 \}}
\DoxyCodeLine{209 }
\DoxyCodeLine{210 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbi\_\_end\_write\_file(stbi\_\_write\_context *s)}
\DoxyCodeLine{211 \{}
\DoxyCodeLine{212    fclose((FILE *)s-\/>context);}
\DoxyCodeLine{213 \}}
\DoxyCodeLine{214 }
\DoxyCodeLine{215 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// !STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{216 }
\DoxyCodeLine{217 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stbiw\_uint32;}
\DoxyCodeLine{218 \textcolor{keyword}{typedef} \textcolor{keywordtype}{int} stb\_image\_write\_test[\textcolor{keyword}{sizeof}(stbiw\_uint32)==4 ? 1 : -\/1];}
\DoxyCodeLine{219 }
\DoxyCodeLine{220 \textcolor{preprocessor}{\#ifdef STB\_IMAGE\_WRITE\_STATIC}}
\DoxyCodeLine{221 \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a7aa69838d830bd1e917b2a20d2030e0c}{stbi\_write\_tga\_with\_rle}} = 1;}
\DoxyCodeLine{222 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{223 \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a7aa69838d830bd1e917b2a20d2030e0c}{stbi\_write\_tga\_with\_rle}} = 1;}
\DoxyCodeLine{224 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbiw\_\_writefv(stbi\_\_write\_context *s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, va\_list v)}
\DoxyCodeLine{227 \{}
\DoxyCodeLine{228    \textcolor{keywordflow}{while} (*fmt) \{}
\DoxyCodeLine{229       \textcolor{keywordflow}{switch} (*fmt++) \{}
\DoxyCodeLine{230          \textcolor{keywordflow}{case} \textcolor{charliteral}{' '}: \textcolor{keywordflow}{break};}
\DoxyCodeLine{231          \textcolor{keywordflow}{case} \textcolor{charliteral}{'1'}: \{ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} x = (\textcolor{keywordtype}{unsigned} char) va\_arg(v, \textcolor{keywordtype}{int});}
\DoxyCodeLine{232                      s-\/>func(s-\/>context,\&x,1);}
\DoxyCodeLine{233                      \textcolor{keywordflow}{break}; \}}
\DoxyCodeLine{234          \textcolor{keywordflow}{case} \textcolor{charliteral}{'2'}: \{ \textcolor{keywordtype}{int} x = va\_arg(v,\textcolor{keywordtype}{int});}
\DoxyCodeLine{235                      \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} b[2];}
\DoxyCodeLine{236                      b[0] = (\textcolor{keywordtype}{unsigned} char) x;}
\DoxyCodeLine{237                      b[1] = (\textcolor{keywordtype}{unsigned} char) (x>>8);}
\DoxyCodeLine{238                      s-\/>func(s-\/>context,b,2);}
\DoxyCodeLine{239                      \textcolor{keywordflow}{break}; \}}
\DoxyCodeLine{240          \textcolor{keywordflow}{case} \textcolor{charliteral}{'4'}: \{ stbiw\_uint32 x = va\_arg(v,\textcolor{keywordtype}{int});}
\DoxyCodeLine{241                      \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} b[4];}
\DoxyCodeLine{242                      b[0]=(\textcolor{keywordtype}{unsigned} char)x;}
\DoxyCodeLine{243                      b[1]=(\textcolor{keywordtype}{unsigned} char)(x>>8);}
\DoxyCodeLine{244                      b[2]=(\textcolor{keywordtype}{unsigned} char)(x>>16);}
\DoxyCodeLine{245                      b[3]=(\textcolor{keywordtype}{unsigned} char)(x>>24);}
\DoxyCodeLine{246                      s-\/>func(s-\/>context,b,4);}
\DoxyCodeLine{247                      \textcolor{keywordflow}{break}; \}}
\DoxyCodeLine{248          \textcolor{keywordflow}{default}:}
\DoxyCodeLine{249             STBIW\_ASSERT(0);}
\DoxyCodeLine{250             \textcolor{keywordflow}{return};}
\DoxyCodeLine{251       \}}
\DoxyCodeLine{252    \}}
\DoxyCodeLine{253 \}}
\DoxyCodeLine{254 }
\DoxyCodeLine{255 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbiw\_\_writef(stbi\_\_write\_context *s, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, ...)}
\DoxyCodeLine{256 \{}
\DoxyCodeLine{257    va\_list v;}
\DoxyCodeLine{258    va\_start(v, fmt);}
\DoxyCodeLine{259    stbiw\_\_writefv(s, fmt, v);}
\DoxyCodeLine{260    va\_end(v);}
\DoxyCodeLine{261 \}}
\DoxyCodeLine{262 }
\DoxyCodeLine{263 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbiw\_\_write3(stbi\_\_write\_context *s, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} a, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} b, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} c)}
\DoxyCodeLine{264 \{}
\DoxyCodeLine{265    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} arr[3];}
\DoxyCodeLine{266    arr[0] = a, arr[1] = b, arr[2] = c;}
\DoxyCodeLine{267    s-\/>func(s-\/>context, arr, 3);}
\DoxyCodeLine{268 \}}
\DoxyCodeLine{269 }
\DoxyCodeLine{270 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbiw\_\_write\_pixel(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} rgb\_dir, \textcolor{keywordtype}{int} comp, \textcolor{keywordtype}{int} write\_alpha, \textcolor{keywordtype}{int} expand\_mono, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *d)}
\DoxyCodeLine{271 \{}
\DoxyCodeLine{272    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} bg[3] = \{ 255, 0, 255\}, px[3];}
\DoxyCodeLine{273    \textcolor{keywordtype}{int} k;}
\DoxyCodeLine{274 }
\DoxyCodeLine{275    \textcolor{keywordflow}{if} (write\_alpha < 0)}
\DoxyCodeLine{276       s-\/>func(s-\/>context, \&d[comp -\/ 1], 1);}
\DoxyCodeLine{277 }
\DoxyCodeLine{278    \textcolor{keywordflow}{switch} (comp) \{}
\DoxyCodeLine{279       \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{280          s-\/>func(s-\/>context,d,1);}
\DoxyCodeLine{281          \textcolor{keywordflow}{break};}
\DoxyCodeLine{282       \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{283          \textcolor{keywordflow}{if} (expand\_mono)}
\DoxyCodeLine{284             stbiw\_\_write3(s, d[0], d[0], d[0]); \textcolor{comment}{// monochrome bmp}}
\DoxyCodeLine{285          \textcolor{keywordflow}{else}}
\DoxyCodeLine{286             s-\/>func(s-\/>context, d, 1);  \textcolor{comment}{// monochrome TGA}}
\DoxyCodeLine{287          \textcolor{keywordflow}{break};}
\DoxyCodeLine{288       \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{289          \textcolor{keywordflow}{if} (!write\_alpha) \{}
\DoxyCodeLine{290             \textcolor{comment}{// composite against pink background}}
\DoxyCodeLine{291             \textcolor{keywordflow}{for} (k = 0; k < 3; ++k)}
\DoxyCodeLine{292                px[k] = bg[k] + ((d[k] -\/ bg[k]) * d[3]) / 255;}
\DoxyCodeLine{293             stbiw\_\_write3(s, px[1 -\/ rgb\_dir], px[1], px[1 + rgb\_dir]);}
\DoxyCodeLine{294             \textcolor{keywordflow}{break};}
\DoxyCodeLine{295          \}}
\DoxyCodeLine{296          \textcolor{comment}{/* FALLTHROUGH */}}
\DoxyCodeLine{297       \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{298          stbiw\_\_write3(s, d[1 -\/ rgb\_dir], d[1], d[1 + rgb\_dir]);}
\DoxyCodeLine{299          \textcolor{keywordflow}{break};}
\DoxyCodeLine{300    \}}
\DoxyCodeLine{301    \textcolor{keywordflow}{if} (write\_alpha > 0)}
\DoxyCodeLine{302       s-\/>func(s-\/>context, \&d[comp -\/ 1], 1);}
\DoxyCodeLine{303 \}}
\DoxyCodeLine{304 }
\DoxyCodeLine{305 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbiw\_\_write\_pixels(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} rgb\_dir, \textcolor{keywordtype}{int} vdir, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} write\_alpha, \textcolor{keywordtype}{int} scanline\_pad, \textcolor{keywordtype}{int} expand\_mono)}
\DoxyCodeLine{306 \{}
\DoxyCodeLine{307    stbiw\_uint32 zero = 0;}
\DoxyCodeLine{308    \textcolor{keywordtype}{int} i,j, j\_end;}
\DoxyCodeLine{309 }
\DoxyCodeLine{310    \textcolor{keywordflow}{if} (y <= 0)}
\DoxyCodeLine{311       \textcolor{keywordflow}{return};}
\DoxyCodeLine{312 }
\DoxyCodeLine{313    \textcolor{keywordflow}{if} (vdir < 0)}
\DoxyCodeLine{314       j\_end = -\/1, j = y-\/1;}
\DoxyCodeLine{315    \textcolor{keywordflow}{else}}
\DoxyCodeLine{316       j\_end =  y, j = 0;}
\DoxyCodeLine{317 }
\DoxyCodeLine{318    \textcolor{keywordflow}{for} (; j != j\_end; j += vdir) \{}
\DoxyCodeLine{319       \textcolor{keywordflow}{for} (i=0; i < x; ++i) \{}
\DoxyCodeLine{320          \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *d = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) data + (j*x+i)*comp;}
\DoxyCodeLine{321          stbiw\_\_write\_pixel(s, rgb\_dir, comp, write\_alpha, expand\_mono, d);}
\DoxyCodeLine{322       \}}
\DoxyCodeLine{323       s-\/>func(s-\/>context, \&zero, scanline\_pad);}
\DoxyCodeLine{324    \}}
\DoxyCodeLine{325 \}}
\DoxyCodeLine{326 }
\DoxyCodeLine{327 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stbiw\_\_outfile(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} rgb\_dir, \textcolor{keywordtype}{int} vdir, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keywordtype}{int} expand\_mono, \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} alpha, \textcolor{keywordtype}{int} pad, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, ...)}
\DoxyCodeLine{328 \{}
\DoxyCodeLine{329    \textcolor{keywordflow}{if} (y < 0 || x < 0) \{}
\DoxyCodeLine{330       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{331    \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{332       va\_list v;}
\DoxyCodeLine{333       va\_start(v, fmt);}
\DoxyCodeLine{334       stbiw\_\_writefv(s, fmt, v);}
\DoxyCodeLine{335       va\_end(v);}
\DoxyCodeLine{336       stbiw\_\_write\_pixels(s,rgb\_dir,vdir,x,y,comp,data,alpha,pad, expand\_mono);}
\DoxyCodeLine{337       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{338    \}}
\DoxyCodeLine{339 \}}
\DoxyCodeLine{340 }
\DoxyCodeLine{341 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stbi\_write\_bmp\_core(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data)}
\DoxyCodeLine{342 \{}
\DoxyCodeLine{343    \textcolor{keywordtype}{int} pad = (-\/x*3) \& 3;}
\DoxyCodeLine{344    \textcolor{keywordflow}{return} stbiw\_\_outfile(s,-\/1,-\/1,x,y,comp,1,(\textcolor{keywordtype}{void} *) data,0,pad,}
\DoxyCodeLine{345            \textcolor{stringliteral}{"{}11 4 22 4"{}} \textcolor{stringliteral}{"{}4 44 22 444444"{}},}
\DoxyCodeLine{346            \textcolor{charliteral}{'B'}, \textcolor{charliteral}{'M'}, 14+40+(x*3+pad)*y, 0,0, 14+40,  \textcolor{comment}{// file header}}
\DoxyCodeLine{347             40, x,y, 1,24, 0,0,0,0,0,0);             \textcolor{comment}{// bitmap header}}
\DoxyCodeLine{348 \}}
\DoxyCodeLine{349 }
\DoxyCodeLine{350 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_aca9573665994b2244a6a045b2a1df1ea}{stbi\_write\_bmp\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data)}
\DoxyCodeLine{351 \{}
\DoxyCodeLine{352    stbi\_\_write\_context s;}
\DoxyCodeLine{353    stbi\_\_start\_write\_callbacks(\&s, func, context);}
\DoxyCodeLine{354    \textcolor{keywordflow}{return} stbi\_write\_bmp\_core(\&s, x, y, comp, data);}
\DoxyCodeLine{355 \}}
\DoxyCodeLine{356 }
\DoxyCodeLine{357 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{358 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a4f63ec842984e5db3edf2da89f16038e}{stbi\_write\_bmp}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data)}
\DoxyCodeLine{359 \{}
\DoxyCodeLine{360    stbi\_\_write\_context s;}
\DoxyCodeLine{361    \textcolor{keywordflow}{if} (stbi\_\_start\_write\_file(\&s,filename)) \{}
\DoxyCodeLine{362       \textcolor{keywordtype}{int} r = stbi\_write\_bmp\_core(\&s, x, y, comp, data);}
\DoxyCodeLine{363       stbi\_\_end\_write\_file(\&s);}
\DoxyCodeLine{364       \textcolor{keywordflow}{return} r;}
\DoxyCodeLine{365    \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{366       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{367 \}}
\DoxyCodeLine{368 \textcolor{preprocessor}{\#endif }}
\DoxyCodeLine{369 }
\DoxyCodeLine{370 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stbi\_write\_tga\_core(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keywordtype}{void} *data)}
\DoxyCodeLine{371 \{}
\DoxyCodeLine{372    \textcolor{keywordtype}{int} has\_alpha = (comp == 2 || comp == 4);}
\DoxyCodeLine{373    \textcolor{keywordtype}{int} colorbytes = has\_alpha ? comp-\/1 : comp;}
\DoxyCodeLine{374    \textcolor{keywordtype}{int} format = colorbytes < 2 ? 3 : 2; \textcolor{comment}{// 3 color channels (RGB/RGBA) = 2, 1 color channel (Y/YA) = 3}}
\DoxyCodeLine{375 }
\DoxyCodeLine{376    \textcolor{keywordflow}{if} (y < 0 || x < 0)}
\DoxyCodeLine{377       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{378 }
\DoxyCodeLine{379    \textcolor{keywordflow}{if} (!\mbox{\hyperlink{stb__image__write_8h_a7aa69838d830bd1e917b2a20d2030e0c}{stbi\_write\_tga\_with\_rle}}) \{}
\DoxyCodeLine{380       \textcolor{keywordflow}{return} stbiw\_\_outfile(s, -\/1, -\/1, x, y, comp, 0, (\textcolor{keywordtype}{void} *) data, has\_alpha, 0,}
\DoxyCodeLine{381          \textcolor{stringliteral}{"{}111 221 2222 11"{}}, 0, 0, format, 0, 0, 0, 0, 0, x, y, (colorbytes + has\_alpha) * 8, has\_alpha * 8);}
\DoxyCodeLine{382    \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{383       \textcolor{keywordtype}{int} i,j,k;}
\DoxyCodeLine{384 }
\DoxyCodeLine{385       stbiw\_\_writef(s, \textcolor{stringliteral}{"{}111 221 2222 11"{}}, 0,0,format+8, 0,0,0, 0,0,x,y, (colorbytes + has\_alpha) * 8, has\_alpha * 8);}
\DoxyCodeLine{386 }
\DoxyCodeLine{387       \textcolor{keywordflow}{for} (j = y -\/ 1; j >= 0; -\/-\/j) \{}
\DoxyCodeLine{388           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *row = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) data + j * x * comp;}
\DoxyCodeLine{389          \textcolor{keywordtype}{int} len;}
\DoxyCodeLine{390 }
\DoxyCodeLine{391          \textcolor{keywordflow}{for} (i = 0; i < x; i += len) \{}
\DoxyCodeLine{392             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *begin = row + i * comp;}
\DoxyCodeLine{393             \textcolor{keywordtype}{int} diff = 1;}
\DoxyCodeLine{394             len = 1;}
\DoxyCodeLine{395 }
\DoxyCodeLine{396             \textcolor{keywordflow}{if} (i < x -\/ 1) \{}
\DoxyCodeLine{397                ++len;}
\DoxyCodeLine{398                diff = memcmp(begin, row + (i + 1) * comp, comp);}
\DoxyCodeLine{399                \textcolor{keywordflow}{if} (diff) \{}
\DoxyCodeLine{400                   \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *prev = begin;}
\DoxyCodeLine{401                   \textcolor{keywordflow}{for} (k = i + 2; k < x \&\& len < 128; ++k) \{}
\DoxyCodeLine{402                      \textcolor{keywordflow}{if} (memcmp(prev, row + k * comp, comp)) \{}
\DoxyCodeLine{403                         prev += comp;}
\DoxyCodeLine{404                         ++len;}
\DoxyCodeLine{405                      \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{406                         -\/-\/len;}
\DoxyCodeLine{407                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{408                      \}}
\DoxyCodeLine{409                   \}}
\DoxyCodeLine{410                \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{411                   \textcolor{keywordflow}{for} (k = i + 2; k < x \&\& len < 128; ++k) \{}
\DoxyCodeLine{412                      \textcolor{keywordflow}{if} (!memcmp(begin, row + k * comp, comp)) \{}
\DoxyCodeLine{413                         ++len;}
\DoxyCodeLine{414                      \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{415                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{416                      \}}
\DoxyCodeLine{417                   \}}
\DoxyCodeLine{418                \}}
\DoxyCodeLine{419             \}}
\DoxyCodeLine{420 }
\DoxyCodeLine{421             \textcolor{keywordflow}{if} (diff) \{}
\DoxyCodeLine{422                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} header = (\textcolor{keywordtype}{unsigned} char) (len -\/ 1);}
\DoxyCodeLine{423                s-\/>func(s-\/>context, \&header, 1);}
\DoxyCodeLine{424                \textcolor{keywordflow}{for} (k = 0; k < len; ++k) \{}
\DoxyCodeLine{425                   stbiw\_\_write\_pixel(s, -\/1, comp, has\_alpha, 0, begin + k * comp);}
\DoxyCodeLine{426                \}}
\DoxyCodeLine{427             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{428                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} header = (\textcolor{keywordtype}{unsigned} char) (len -\/ 129);}
\DoxyCodeLine{429                s-\/>func(s-\/>context, \&header, 1);}
\DoxyCodeLine{430                stbiw\_\_write\_pixel(s, -\/1, comp, has\_alpha, 0, begin);}
\DoxyCodeLine{431             \}}
\DoxyCodeLine{432          \}}
\DoxyCodeLine{433       \}}
\DoxyCodeLine{434    \}}
\DoxyCodeLine{435    \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{436 \}}
\DoxyCodeLine{437 }
\DoxyCodeLine{438 \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a5e5c6483c1d45a65fe208f52937cd315}{stbi\_write\_tga\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data)}
\DoxyCodeLine{439 \{}
\DoxyCodeLine{440    stbi\_\_write\_context s;}
\DoxyCodeLine{441    stbi\_\_start\_write\_callbacks(\&s, func, context);}
\DoxyCodeLine{442    \textcolor{keywordflow}{return} stbi\_write\_tga\_core(\&s, x, y, comp, (\textcolor{keywordtype}{void} *) data);}
\DoxyCodeLine{443 \}}
\DoxyCodeLine{444 }
\DoxyCodeLine{445 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{446 \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_ab7a84427c6d7e894090fbeae3bc8f6da}{stbi\_write\_tga}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data)}
\DoxyCodeLine{447 \{}
\DoxyCodeLine{448    stbi\_\_write\_context s;}
\DoxyCodeLine{449    \textcolor{keywordflow}{if} (stbi\_\_start\_write\_file(\&s,filename)) \{}
\DoxyCodeLine{450       \textcolor{keywordtype}{int} r = stbi\_write\_tga\_core(\&s, x, y, comp, (\textcolor{keywordtype}{void} *) data);}
\DoxyCodeLine{451       stbi\_\_end\_write\_file(\&s);}
\DoxyCodeLine{452       \textcolor{keywordflow}{return} r;}
\DoxyCodeLine{453    \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{454       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{455 \}}
\DoxyCodeLine{456 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{457 }
\DoxyCodeLine{458 \textcolor{comment}{// *************************************************************************************************}}
\DoxyCodeLine{459 \textcolor{comment}{// Radiance RGBE HDR writer}}
\DoxyCodeLine{460 \textcolor{comment}{// by Baldur Karlsson}}
\DoxyCodeLine{461 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{462 }
\DoxyCodeLine{463 \textcolor{preprocessor}{\#define stbiw\_\_max(a, b)  ((a) > (b) ? (a) : (b))}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465 \textcolor{keywordtype}{void} stbiw\_\_linear\_to\_rgbe(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *rgbe, \textcolor{keywordtype}{float} *linear)}
\DoxyCodeLine{466 \{}
\DoxyCodeLine{467    \textcolor{keywordtype}{int} exponent;}
\DoxyCodeLine{468    \textcolor{keywordtype}{float} maxcomp = stbiw\_\_max(linear[0], stbiw\_\_max(linear[1], linear[2]));}
\DoxyCodeLine{469 }
\DoxyCodeLine{470    \textcolor{keywordflow}{if} (maxcomp < 1e-\/32) \{}
\DoxyCodeLine{471       rgbe[0] = rgbe[1] = rgbe[2] = rgbe[3] = 0;}
\DoxyCodeLine{472    \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{473       \textcolor{keywordtype}{float} normalize = (float) frexp(maxcomp, \&exponent) * 256.0f/maxcomp;}
\DoxyCodeLine{474 }
\DoxyCodeLine{475       rgbe[0] = (\textcolor{keywordtype}{unsigned} char)(linear[0] * normalize);}
\DoxyCodeLine{476       rgbe[1] = (\textcolor{keywordtype}{unsigned} char)(linear[1] * normalize);}
\DoxyCodeLine{477       rgbe[2] = (\textcolor{keywordtype}{unsigned} char)(linear[2] * normalize);}
\DoxyCodeLine{478       rgbe[3] = (\textcolor{keywordtype}{unsigned} char)(exponent + 128);}
\DoxyCodeLine{479    \}}
\DoxyCodeLine{480 \}}
\DoxyCodeLine{481 }
\DoxyCodeLine{482 \textcolor{keywordtype}{void} stbiw\_\_write\_run\_data(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} length, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} databyte)}
\DoxyCodeLine{483 \{}
\DoxyCodeLine{484    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} lengthbyte = (\textcolor{keywordtype}{unsigned} char) (length+128);}
\DoxyCodeLine{485    STBIW\_ASSERT(length+128 <= 255);}
\DoxyCodeLine{486    s-\/>func(s-\/>context, \&lengthbyte, 1);}
\DoxyCodeLine{487    s-\/>func(s-\/>context, \&databyte, 1);}
\DoxyCodeLine{488 \}}
\DoxyCodeLine{489 }
\DoxyCodeLine{490 \textcolor{keywordtype}{void} stbiw\_\_write\_dump\_data(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} length, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data)}
\DoxyCodeLine{491 \{}
\DoxyCodeLine{492    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} lengthbyte = (\textcolor{keywordtype}{unsigned} char )(length \& 0xff);}
\DoxyCodeLine{493    STBIW\_ASSERT(length <= 128); \textcolor{comment}{// inconsistent with spec but consistent with official code}}
\DoxyCodeLine{494    s-\/>func(s-\/>context, \&lengthbyte, 1);}
\DoxyCodeLine{495    s-\/>func(s-\/>context, data, length);}
\DoxyCodeLine{496 \}}
\DoxyCodeLine{497 }
\DoxyCodeLine{498 \textcolor{keywordtype}{void} stbiw\_\_write\_hdr\_scanline(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} width, \textcolor{keywordtype}{int} ncomp, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *scratch, \textcolor{keywordtype}{float} *scanline)}
\DoxyCodeLine{499 \{}
\DoxyCodeLine{500    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} scanlineheader[4] = \{ 2, 2, 0, 0 \};}
\DoxyCodeLine{501    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} rgbe[4];}
\DoxyCodeLine{502    \textcolor{keywordtype}{float} linear[3];}
\DoxyCodeLine{503    \textcolor{keywordtype}{int} x;}
\DoxyCodeLine{504 }
\DoxyCodeLine{505    scanlineheader[2] = (width\&0xff00)>>8;}
\DoxyCodeLine{506    scanlineheader[3] = (width\&0x00ff);}
\DoxyCodeLine{507 }
\DoxyCodeLine{508    \textcolor{comment}{/* skip RLE for images too small or large */}}
\DoxyCodeLine{509    \textcolor{keywordflow}{if} (width < 8 || width >= 32768) \{}
\DoxyCodeLine{510       \textcolor{keywordflow}{for} (x=0; x < width; x++) \{}
\DoxyCodeLine{511          \textcolor{keywordflow}{switch} (ncomp) \{}
\DoxyCodeLine{512             \textcolor{keywordflow}{case} 4: \textcolor{comment}{/* fallthrough */}}
\DoxyCodeLine{513             \textcolor{keywordflow}{case} 3: linear[2] = scanline[x*ncomp + 2];}
\DoxyCodeLine{514                     linear[1] = scanline[x*ncomp + 1];}
\DoxyCodeLine{515                     linear[0] = scanline[x*ncomp + 0];}
\DoxyCodeLine{516                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{517             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{518                     linear[0] = linear[1] = linear[2] = scanline[x*ncomp + 0];}
\DoxyCodeLine{519                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{520          \}}
\DoxyCodeLine{521          stbiw\_\_linear\_to\_rgbe(rgbe, linear);}
\DoxyCodeLine{522          s-\/>func(s-\/>context, rgbe, 4);}
\DoxyCodeLine{523       \}}
\DoxyCodeLine{524    \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{525       \textcolor{keywordtype}{int} c,r;}
\DoxyCodeLine{526       \textcolor{comment}{/* encode into scratch buffer */}}
\DoxyCodeLine{527       \textcolor{keywordflow}{for} (x=0; x < width; x++) \{}
\DoxyCodeLine{528          \textcolor{keywordflow}{switch}(ncomp) \{}
\DoxyCodeLine{529             \textcolor{keywordflow}{case} 4: \textcolor{comment}{/* fallthrough */}}
\DoxyCodeLine{530             \textcolor{keywordflow}{case} 3: linear[2] = scanline[x*ncomp + 2];}
\DoxyCodeLine{531                     linear[1] = scanline[x*ncomp + 1];}
\DoxyCodeLine{532                     linear[0] = scanline[x*ncomp + 0];}
\DoxyCodeLine{533                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{534             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{535                     linear[0] = linear[1] = linear[2] = scanline[x*ncomp + 0];}
\DoxyCodeLine{536                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{537          \}}
\DoxyCodeLine{538          stbiw\_\_linear\_to\_rgbe(rgbe, linear);}
\DoxyCodeLine{539          scratch[x + width*0] = rgbe[0];}
\DoxyCodeLine{540          scratch[x + width*1] = rgbe[1];}
\DoxyCodeLine{541          scratch[x + width*2] = rgbe[2];}
\DoxyCodeLine{542          scratch[x + width*3] = rgbe[3];}
\DoxyCodeLine{543       \}}
\DoxyCodeLine{544 }
\DoxyCodeLine{545       s-\/>func(s-\/>context, scanlineheader, 4);}
\DoxyCodeLine{546 }
\DoxyCodeLine{547       \textcolor{comment}{/* RLE each component separately */}}
\DoxyCodeLine{548       \textcolor{keywordflow}{for} (c=0; c < 4; c++) \{}
\DoxyCodeLine{549          \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *comp = \&scratch[width*c];}
\DoxyCodeLine{550 }
\DoxyCodeLine{551          x = 0;}
\DoxyCodeLine{552          \textcolor{keywordflow}{while} (x < width) \{}
\DoxyCodeLine{553             \textcolor{comment}{// find first run}}
\DoxyCodeLine{554             r = x;}
\DoxyCodeLine{555             \textcolor{keywordflow}{while} (r+2 < width) \{}
\DoxyCodeLine{556                \textcolor{keywordflow}{if} (comp[r] == comp[r+1] \&\& comp[r] == comp[r+2])}
\DoxyCodeLine{557                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{558                ++r;}
\DoxyCodeLine{559             \}}
\DoxyCodeLine{560             \textcolor{keywordflow}{if} (r+2 >= width)}
\DoxyCodeLine{561                r = width;}
\DoxyCodeLine{562             \textcolor{comment}{// dump up to first run}}
\DoxyCodeLine{563             \textcolor{keywordflow}{while} (x < r) \{}
\DoxyCodeLine{564                \textcolor{keywordtype}{int} len = r-\/x;}
\DoxyCodeLine{565                \textcolor{keywordflow}{if} (len > 128) len = 128;}
\DoxyCodeLine{566                stbiw\_\_write\_dump\_data(s, len, \&comp[x]);}
\DoxyCodeLine{567                x += len;}
\DoxyCodeLine{568             \}}
\DoxyCodeLine{569             \textcolor{comment}{// if there's a run, output it}}
\DoxyCodeLine{570             \textcolor{keywordflow}{if} (r+2 < width) \{ \textcolor{comment}{// same test as what we break out of in search loop, so only true if we break'd}}
\DoxyCodeLine{571                \textcolor{comment}{// find next byte after run}}
\DoxyCodeLine{572                \textcolor{keywordflow}{while} (r < width \&\& comp[r] == comp[x])}
\DoxyCodeLine{573                   ++r;}
\DoxyCodeLine{574                \textcolor{comment}{// output run up to r}}
\DoxyCodeLine{575                \textcolor{keywordflow}{while} (x < r) \{}
\DoxyCodeLine{576                   \textcolor{keywordtype}{int} len = r-\/x;}
\DoxyCodeLine{577                   \textcolor{keywordflow}{if} (len > 127) len = 127;}
\DoxyCodeLine{578                   stbiw\_\_write\_run\_data(s, len, comp[x]);}
\DoxyCodeLine{579                   x += len;}
\DoxyCodeLine{580                \}}
\DoxyCodeLine{581             \}}
\DoxyCodeLine{582          \}}
\DoxyCodeLine{583       \}}
\DoxyCodeLine{584    \}}
\DoxyCodeLine{585 \}}
\DoxyCodeLine{586 }
\DoxyCodeLine{587 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stbi\_write\_hdr\_core(stbi\_\_write\_context *s, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keywordtype}{float} *data)}
\DoxyCodeLine{588 \{}
\DoxyCodeLine{589    \textcolor{keywordflow}{if} (y <= 0 || x <= 0 || data == NULL)}
\DoxyCodeLine{590       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{591    \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{592       \textcolor{comment}{// Each component is stored separately. Allocate scratch space for full output scanline.}}
\DoxyCodeLine{593       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *scratch = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) STBIW\_MALLOC(x*4);}
\DoxyCodeLine{594       \textcolor{keywordtype}{int} i, len;}
\DoxyCodeLine{595       \textcolor{keywordtype}{char} buffer[128];}
\DoxyCodeLine{596       \textcolor{keywordtype}{char} header[] = \textcolor{stringliteral}{"{}\#?RADIANCE\(\backslash\)n\# Written by stb\_image\_write.h\(\backslash\)nFORMAT=32-\/bit\_rle\_rgbe\(\backslash\)n"{}};}
\DoxyCodeLine{597       s-\/>func(s-\/>context, header, \textcolor{keyword}{sizeof}(header)-\/1);}
\DoxyCodeLine{598 }
\DoxyCodeLine{599       len = sprintf(buffer, \textcolor{stringliteral}{"{}EXPOSURE=          1.0000000000000\(\backslash\)n\(\backslash\)n-\/Y \%d +X \%d\(\backslash\)n"{}}, y, x);}
\DoxyCodeLine{600       s-\/>func(s-\/>context, buffer, len);}
\DoxyCodeLine{601 }
\DoxyCodeLine{602       \textcolor{keywordflow}{for}(i=0; i < y; i++)}
\DoxyCodeLine{603          stbiw\_\_write\_hdr\_scanline(s, x, comp, scratch, data + comp*i*x);}
\DoxyCodeLine{604       STBIW\_FREE(scratch);}
\DoxyCodeLine{605       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{606    \}}
\DoxyCodeLine{607 \}}
\DoxyCodeLine{608 }
\DoxyCodeLine{609 \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_ac9214f775162b61a3503c76875966c11}{stbi\_write\_hdr\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{float} *data)}
\DoxyCodeLine{610 \{}
\DoxyCodeLine{611    stbi\_\_write\_context s;}
\DoxyCodeLine{612    stbi\_\_start\_write\_callbacks(\&s, func, context);}
\DoxyCodeLine{613    \textcolor{keywordflow}{return} stbi\_write\_hdr\_core(\&s, x, y, comp, (\textcolor{keywordtype}{float} *) data);}
\DoxyCodeLine{614 \}}
\DoxyCodeLine{615 }
\DoxyCodeLine{616 \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a21f22be0194761e08b682ed543ef6161}{stbi\_write\_hdr}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{float} *data)}
\DoxyCodeLine{617 \{}
\DoxyCodeLine{618    stbi\_\_write\_context s;}
\DoxyCodeLine{619    \textcolor{keywordflow}{if} (stbi\_\_start\_write\_file(\&s,filename)) \{}
\DoxyCodeLine{620       \textcolor{keywordtype}{int} r = stbi\_write\_hdr\_core(\&s, x, y, comp, (\textcolor{keywordtype}{float} *) data);}
\DoxyCodeLine{621       stbi\_\_end\_write\_file(\&s);}
\DoxyCodeLine{622       \textcolor{keywordflow}{return} r;}
\DoxyCodeLine{623    \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{624       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{625 \}}
\DoxyCodeLine{626 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{627 }
\DoxyCodeLine{628 }
\DoxyCodeLine{630 \textcolor{comment}{//}}
\DoxyCodeLine{631 \textcolor{comment}{// PNG writer}}
\DoxyCodeLine{632 \textcolor{comment}{//}}
\DoxyCodeLine{633 }
\DoxyCodeLine{634 \textcolor{comment}{// stretchy buffer; stbiw\_\_sbpush() == vector<>::push\_back() -\/-\/ stbiw\_\_sbcount() == vector<>::size()}}
\DoxyCodeLine{635 \textcolor{preprocessor}{\#define stbiw\_\_sbraw(a) ((int *) (a) -\/ 2)}}
\DoxyCodeLine{636 \textcolor{preprocessor}{\#define stbiw\_\_sbm(a)   stbiw\_\_sbraw(a)[0]}}
\DoxyCodeLine{637 \textcolor{preprocessor}{\#define stbiw\_\_sbn(a)   stbiw\_\_sbraw(a)[1]}}
\DoxyCodeLine{638 }
\DoxyCodeLine{639 \textcolor{preprocessor}{\#define stbiw\_\_sbneedgrow(a,n)  ((a)==0 || stbiw\_\_sbn(a)+n >= stbiw\_\_sbm(a))}}
\DoxyCodeLine{640 \textcolor{preprocessor}{\#define stbiw\_\_sbmaybegrow(a,n) (stbiw\_\_sbneedgrow(a,(n)) ? stbiw\_\_sbgrow(a,n) : 0)}}
\DoxyCodeLine{641 \textcolor{preprocessor}{\#define stbiw\_\_sbgrow(a,n)  stbiw\_\_sbgrowf((void **) \&(a), (n), sizeof(*(a)))}}
\DoxyCodeLine{642 }
\DoxyCodeLine{643 \textcolor{preprocessor}{\#define stbiw\_\_sbpush(a, v)      (stbiw\_\_sbmaybegrow(a,1), (a)[stbiw\_\_sbn(a)++] = (v))}}
\DoxyCodeLine{644 \textcolor{preprocessor}{\#define stbiw\_\_sbcount(a)        ((a) ? stbiw\_\_sbn(a) : 0)}}
\DoxyCodeLine{645 \textcolor{preprocessor}{\#define stbiw\_\_sbfree(a)         ((a) ? STBIW\_FREE(stbiw\_\_sbraw(a)),0 : 0)}}
\DoxyCodeLine{646 }
\DoxyCodeLine{647 \textcolor{keyword}{static} \textcolor{keywordtype}{void} *stbiw\_\_sbgrowf(\textcolor{keywordtype}{void} **arr, \textcolor{keywordtype}{int} increment, \textcolor{keywordtype}{int} itemsize)}
\DoxyCodeLine{648 \{}
\DoxyCodeLine{649    \textcolor{keywordtype}{int} m = *arr ? 2*stbiw\_\_sbm(*arr)+increment : increment+1;}
\DoxyCodeLine{650    \textcolor{keywordtype}{void} *p = STBIW\_REALLOC(*arr ? stbiw\_\_sbraw(*arr) : 0, itemsize * m + \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})*2);}
\DoxyCodeLine{651    STBIW\_ASSERT(p);}
\DoxyCodeLine{652    \textcolor{keywordflow}{if} (p) \{}
\DoxyCodeLine{653       \textcolor{keywordflow}{if} (!*arr) ((\textcolor{keywordtype}{int} *) p)[1] = 0;}
\DoxyCodeLine{654       *arr = (\textcolor{keywordtype}{void} *) ((\textcolor{keywordtype}{int} *) p + 2);}
\DoxyCodeLine{655       stbiw\_\_sbm(*arr) = m;}
\DoxyCodeLine{656    \}}
\DoxyCodeLine{657    \textcolor{keywordflow}{return} *arr;}
\DoxyCodeLine{658 \}}
\DoxyCodeLine{659 }
\DoxyCodeLine{660 \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *stbiw\_\_zlib\_flushf(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *bitbuffer, \textcolor{keywordtype}{int} *bitcount)}
\DoxyCodeLine{661 \{}
\DoxyCodeLine{662    \textcolor{keywordflow}{while} (*bitcount >= 8) \{}
\DoxyCodeLine{663       stbiw\_\_sbpush(data, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) *bitbuffer);}
\DoxyCodeLine{664       *bitbuffer >>= 8;}
\DoxyCodeLine{665       *bitcount -\/= 8;}
\DoxyCodeLine{666    \}}
\DoxyCodeLine{667    \textcolor{keywordflow}{return} data;}
\DoxyCodeLine{668 \}}
\DoxyCodeLine{669 }
\DoxyCodeLine{670 \textcolor{keyword}{static} \textcolor{keywordtype}{int} stbiw\_\_zlib\_bitrev(\textcolor{keywordtype}{int} code, \textcolor{keywordtype}{int} codebits)}
\DoxyCodeLine{671 \{}
\DoxyCodeLine{672    \textcolor{keywordtype}{int} res=0;}
\DoxyCodeLine{673    \textcolor{keywordflow}{while} (codebits-\/-\/) \{}
\DoxyCodeLine{674       res = (res << 1) | (code \& 1);}
\DoxyCodeLine{675       code >>= 1;}
\DoxyCodeLine{676    \}}
\DoxyCodeLine{677    \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{678 \}}
\DoxyCodeLine{679 }
\DoxyCodeLine{680 \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stbiw\_\_zlib\_countm(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *a, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *b, \textcolor{keywordtype}{int} limit)}
\DoxyCodeLine{681 \{}
\DoxyCodeLine{682    \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{683    \textcolor{keywordflow}{for} (i=0; i < limit \&\& i < 258; ++i)}
\DoxyCodeLine{684       \textcolor{keywordflow}{if} (a[i] != b[i]) \textcolor{keywordflow}{break};}
\DoxyCodeLine{685    \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{686 \}}
\DoxyCodeLine{687 }
\DoxyCodeLine{688 \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stbiw\_\_zhash(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data)}
\DoxyCodeLine{689 \{}
\DoxyCodeLine{690    stbiw\_uint32 hash = data[0] + (data[1] << 8) + (data[2] << 16);}
\DoxyCodeLine{691    hash \string^= hash << 3;}
\DoxyCodeLine{692    hash += hash >> 5;}
\DoxyCodeLine{693    hash \string^= hash << 4;}
\DoxyCodeLine{694    hash += hash >> 17;}
\DoxyCodeLine{695    hash \string^= hash << 25;}
\DoxyCodeLine{696    hash += hash >> 6;}
\DoxyCodeLine{697    \textcolor{keywordflow}{return} hash;}
\DoxyCodeLine{698 \}}
\DoxyCodeLine{699 }
\DoxyCodeLine{700 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_flush() (out = stbiw\_\_zlib\_flushf(out, \&bitbuf, \&bitcount))}}
\DoxyCodeLine{701 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_add(code,codebits) \(\backslash\)}}
\DoxyCodeLine{702 \textcolor{preprocessor}{      (bitbuf |= (code) << bitcount, bitcount += (codebits), stbiw\_\_zlib\_flush())}}
\DoxyCodeLine{703 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huffa(b,c)  stbiw\_\_zlib\_add(stbiw\_\_zlib\_bitrev(b,c),c)}}
\DoxyCodeLine{704 \textcolor{comment}{// default huffman tables}}
\DoxyCodeLine{705 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huff1(n)  stbiw\_\_zlib\_huffa(0x30 + (n), 8)}}
\DoxyCodeLine{706 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huff2(n)  stbiw\_\_zlib\_huffa(0x190 + (n)-\/144, 9)}}
\DoxyCodeLine{707 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huff3(n)  stbiw\_\_zlib\_huffa(0 + (n)-\/256,7)}}
\DoxyCodeLine{708 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huff4(n)  stbiw\_\_zlib\_huffa(0xc0 + (n)-\/280,8)}}
\DoxyCodeLine{709 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huff(n)  ((n) <= 143 ? stbiw\_\_zlib\_huff1(n) : (n) <= 255 ? stbiw\_\_zlib\_huff2(n) : (n) <= 279 ? stbiw\_\_zlib\_huff3(n) : stbiw\_\_zlib\_huff4(n))}}
\DoxyCodeLine{710 \textcolor{preprocessor}{\#define stbiw\_\_zlib\_huffb(n) ((n) <= 143 ? stbiw\_\_zlib\_huff1(n) : stbiw\_\_zlib\_huff2(n))}}
\DoxyCodeLine{711 }
\DoxyCodeLine{712 \textcolor{preprocessor}{\#define stbiw\_\_ZHASH   16384}}
\DoxyCodeLine{713 }
\DoxyCodeLine{714 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} * stbi\_zlib\_compress(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *data, \textcolor{keywordtype}{int} data\_len, \textcolor{keywordtype}{int} *out\_len, \textcolor{keywordtype}{int} quality)}
\DoxyCodeLine{715 \{}
\DoxyCodeLine{716    \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} lengthc[] = \{ 3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258, 259 \};}
\DoxyCodeLine{717    \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}  lengtheb[]= \{ 0,0,0,0,0,0,0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,  4,  5,  5,  5,  5,  0 \};}
\DoxyCodeLine{718    \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} distc[]   = \{ 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577, 32768 \};}
\DoxyCodeLine{719    \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}  disteb[]  = \{ 0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13 \};}
\DoxyCodeLine{720    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bitbuf=0;}
\DoxyCodeLine{721    \textcolor{keywordtype}{int} i,j, bitcount=0;}
\DoxyCodeLine{722    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *out = NULL;}
\DoxyCodeLine{723    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} **hash\_table[stbiw\_\_ZHASH]; \textcolor{comment}{// 64KB on the stack!}}
\DoxyCodeLine{724    \textcolor{keywordflow}{if} (quality < 5) quality = 5;}
\DoxyCodeLine{725 }
\DoxyCodeLine{726    stbiw\_\_sbpush(out, 0x78);   \textcolor{comment}{// DEFLATE 32K window}}
\DoxyCodeLine{727    stbiw\_\_sbpush(out, 0x5e);   \textcolor{comment}{// FLEVEL = 1}}
\DoxyCodeLine{728    stbiw\_\_zlib\_add(1,1);  \textcolor{comment}{// BFINAL = 1}}
\DoxyCodeLine{729    stbiw\_\_zlib\_add(1,2);  \textcolor{comment}{// BTYPE = 1 -\/-\/ fixed huffman}}
\DoxyCodeLine{730 }
\DoxyCodeLine{731    \textcolor{keywordflow}{for} (i=0; i < stbiw\_\_ZHASH; ++i)}
\DoxyCodeLine{732       hash\_table[i] = NULL;}
\DoxyCodeLine{733 }
\DoxyCodeLine{734    i=0;}
\DoxyCodeLine{735    \textcolor{keywordflow}{while} (i < data\_len-\/3) \{}
\DoxyCodeLine{736       \textcolor{comment}{// hash next 3 bytes of data to be compressed}}
\DoxyCodeLine{737       \textcolor{keywordtype}{int} h = stbiw\_\_zhash(data+i)\&(stbiw\_\_ZHASH-\/1), best=3;}
\DoxyCodeLine{738       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *bestloc = 0;}
\DoxyCodeLine{739       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} **hlist = hash\_table[h];}
\DoxyCodeLine{740       \textcolor{keywordtype}{int} n = stbiw\_\_sbcount(hlist);}
\DoxyCodeLine{741       \textcolor{keywordflow}{for} (j=0; j < n; ++j) \{}
\DoxyCodeLine{742          \textcolor{keywordflow}{if} (hlist[j]-\/data > i-\/32768) \{ \textcolor{comment}{// if entry lies within window}}
\DoxyCodeLine{743             \textcolor{keywordtype}{int} d = stbiw\_\_zlib\_countm(hlist[j], data+i, data\_len-\/i);}
\DoxyCodeLine{744             \textcolor{keywordflow}{if} (d >= best) best=d,bestloc=hlist[j];}
\DoxyCodeLine{745          \}}
\DoxyCodeLine{746       \}}
\DoxyCodeLine{747       \textcolor{comment}{// when hash table entry is too long, delete half the entries}}
\DoxyCodeLine{748       \textcolor{keywordflow}{if} (hash\_table[h] \&\& stbiw\_\_sbn(hash\_table[h]) == 2*quality) \{}
\DoxyCodeLine{749          STBIW\_MEMMOVE(hash\_table[h], hash\_table[h]+quality, \textcolor{keyword}{sizeof}(hash\_table[h][0])*quality);}
\DoxyCodeLine{750          stbiw\_\_sbn(hash\_table[h]) = quality;}
\DoxyCodeLine{751       \}}
\DoxyCodeLine{752       stbiw\_\_sbpush(hash\_table[h],data+i);}
\DoxyCodeLine{753 }
\DoxyCodeLine{754       \textcolor{keywordflow}{if} (bestloc) \{}
\DoxyCodeLine{755          \textcolor{comment}{// "{}lazy matching"{} -\/ check match at *next* byte, and if it's better, do cur byte as literal}}
\DoxyCodeLine{756          h = stbiw\_\_zhash(data+i+1)\&(stbiw\_\_ZHASH-\/1);}
\DoxyCodeLine{757          hlist = hash\_table[h];}
\DoxyCodeLine{758          n = stbiw\_\_sbcount(hlist);}
\DoxyCodeLine{759          \textcolor{keywordflow}{for} (j=0; j < n; ++j) \{}
\DoxyCodeLine{760             \textcolor{keywordflow}{if} (hlist[j]-\/data > i-\/32767) \{}
\DoxyCodeLine{761                \textcolor{keywordtype}{int} e = stbiw\_\_zlib\_countm(hlist[j], data+i+1, data\_len-\/i-\/1);}
\DoxyCodeLine{762                \textcolor{keywordflow}{if} (e > best) \{ \textcolor{comment}{// if next match is better, bail on current match}}
\DoxyCodeLine{763                   bestloc = NULL;}
\DoxyCodeLine{764                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{765                \}}
\DoxyCodeLine{766             \}}
\DoxyCodeLine{767          \}}
\DoxyCodeLine{768       \}}
\DoxyCodeLine{769 }
\DoxyCodeLine{770       \textcolor{keywordflow}{if} (bestloc) \{}
\DoxyCodeLine{771          \textcolor{keywordtype}{int} d = (int) (data+i -\/ bestloc); \textcolor{comment}{// distance back}}
\DoxyCodeLine{772          STBIW\_ASSERT(d <= 32767 \&\& best <= 258);}
\DoxyCodeLine{773          \textcolor{keywordflow}{for} (j=0; best > lengthc[j+1]-\/1; ++j);}
\DoxyCodeLine{774          stbiw\_\_zlib\_huff(j+257);}
\DoxyCodeLine{775          \textcolor{keywordflow}{if} (lengtheb[j]) stbiw\_\_zlib\_add(best -\/ lengthc[j], lengtheb[j]);}
\DoxyCodeLine{776          \textcolor{keywordflow}{for} (j=0; d > distc[j+1]-\/1; ++j);}
\DoxyCodeLine{777          stbiw\_\_zlib\_add(stbiw\_\_zlib\_bitrev(j,5),5);}
\DoxyCodeLine{778          \textcolor{keywordflow}{if} (disteb[j]) stbiw\_\_zlib\_add(d -\/ distc[j], disteb[j]);}
\DoxyCodeLine{779          i += best;}
\DoxyCodeLine{780       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{781          stbiw\_\_zlib\_huffb(data[i]);}
\DoxyCodeLine{782          ++i;}
\DoxyCodeLine{783       \}}
\DoxyCodeLine{784    \}}
\DoxyCodeLine{785    \textcolor{comment}{// write out final bytes}}
\DoxyCodeLine{786    \textcolor{keywordflow}{for} (;i < data\_len; ++i)}
\DoxyCodeLine{787       stbiw\_\_zlib\_huffb(data[i]);}
\DoxyCodeLine{788    stbiw\_\_zlib\_huff(256); \textcolor{comment}{// end of block}}
\DoxyCodeLine{789    \textcolor{comment}{// pad with 0 bits to byte boundary}}
\DoxyCodeLine{790    \textcolor{keywordflow}{while} (bitcount)}
\DoxyCodeLine{791       stbiw\_\_zlib\_add(0,1);}
\DoxyCodeLine{792 }
\DoxyCodeLine{793    \textcolor{keywordflow}{for} (i=0; i < stbiw\_\_ZHASH; ++i)}
\DoxyCodeLine{794       (\textcolor{keywordtype}{void}) stbiw\_\_sbfree(hash\_table[i]);}
\DoxyCodeLine{795 }
\DoxyCodeLine{796    \{}
\DoxyCodeLine{797       \textcolor{comment}{// compute adler32 on input}}
\DoxyCodeLine{798       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} s1=1, s2=0;}
\DoxyCodeLine{799       \textcolor{keywordtype}{int} blocklen = (int) (data\_len \% 5552);}
\DoxyCodeLine{800       j=0;}
\DoxyCodeLine{801       \textcolor{keywordflow}{while} (j < data\_len) \{}
\DoxyCodeLine{802          \textcolor{keywordflow}{for} (i=0; i < blocklen; ++i) s1 += data[j+i], s2 += s1;}
\DoxyCodeLine{803          s1 \%= 65521, s2 \%= 65521;}
\DoxyCodeLine{804          j += blocklen;}
\DoxyCodeLine{805          blocklen = 5552;}
\DoxyCodeLine{806       \}}
\DoxyCodeLine{807       stbiw\_\_sbpush(out, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) (s2 >> 8));}
\DoxyCodeLine{808       stbiw\_\_sbpush(out, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) s2);}
\DoxyCodeLine{809       stbiw\_\_sbpush(out, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) (s1 >> 8));}
\DoxyCodeLine{810       stbiw\_\_sbpush(out, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) s1);}
\DoxyCodeLine{811    \}}
\DoxyCodeLine{812    *out\_len = stbiw\_\_sbn(out);}
\DoxyCodeLine{813    \textcolor{comment}{// make returned pointer freeable}}
\DoxyCodeLine{814    STBIW\_MEMMOVE(stbiw\_\_sbraw(out), out, *out\_len);}
\DoxyCodeLine{815    \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) stbiw\_\_sbraw(out);}
\DoxyCodeLine{816 \}}
\DoxyCodeLine{817 }
\DoxyCodeLine{818 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} stbiw\_\_crc32(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *buffer, \textcolor{keywordtype}{int} len)}
\DoxyCodeLine{819 \{}
\DoxyCodeLine{820    \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} crc\_table[256];}
\DoxyCodeLine{821    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} crc = \string~0u;}
\DoxyCodeLine{822    \textcolor{keywordtype}{int} i,j;}
\DoxyCodeLine{823    \textcolor{keywordflow}{if} (crc\_table[1] == 0)}
\DoxyCodeLine{824       \textcolor{keywordflow}{for}(i=0; i < 256; i++)}
\DoxyCodeLine{825          \textcolor{keywordflow}{for} (crc\_table[i]=i, j=0; j < 8; ++j)}
\DoxyCodeLine{826             crc\_table[i] = (crc\_table[i] >> 1) \string^ (crc\_table[i] \& 1 ? 0xedb88320 : 0);}
\DoxyCodeLine{827    \textcolor{keywordflow}{for} (i=0; i < len; ++i)}
\DoxyCodeLine{828       crc = (crc >> 8) \string^ crc\_table[buffer[i] \string^ (crc \& 0xff)];}
\DoxyCodeLine{829    \textcolor{keywordflow}{return} \string~crc;}
\DoxyCodeLine{830 \}}
\DoxyCodeLine{831 }
\DoxyCodeLine{832 \textcolor{preprocessor}{\#define stbiw\_\_wpng4(o,a,b,c,d) ((o)[0]=(unsigned char)(a),(o)[1]=(unsigned char)(b),(o)[2]=(unsigned char)(c),(o)[3]=(unsigned char)(d),(o)+=4)}}
\DoxyCodeLine{833 \textcolor{preprocessor}{\#define stbiw\_\_wp32(data,v) stbiw\_\_wpng4(data, (v)>>24,(v)>>16,(v)>>8,(v));}}
\DoxyCodeLine{834 \textcolor{preprocessor}{\#define stbiw\_\_wptag(data,s) stbiw\_\_wpng4(data, s[0],s[1],s[2],s[3])}}
\DoxyCodeLine{835 }
\DoxyCodeLine{836 \textcolor{keyword}{static} \textcolor{keywordtype}{void} stbiw\_\_wpcrc(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} **data, \textcolor{keywordtype}{int} len)}
\DoxyCodeLine{837 \{}
\DoxyCodeLine{838    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} crc = stbiw\_\_crc32(*data -\/ len -\/ 4, len+4);}
\DoxyCodeLine{839    stbiw\_\_wp32(*data, crc);}
\DoxyCodeLine{840 \}}
\DoxyCodeLine{841 }
\DoxyCodeLine{842 \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} stbiw\_\_paeth(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} c)}
\DoxyCodeLine{843 \{}
\DoxyCodeLine{844    \textcolor{keywordtype}{int} p = a + b -\/ c, pa = abs(p-\/a), pb = abs(p-\/b), pc = abs(p-\/c);}
\DoxyCodeLine{845    \textcolor{keywordflow}{if} (pa <= pb \&\& pa <= pc) \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) a;}
\DoxyCodeLine{846    \textcolor{keywordflow}{if} (pb <= pc) \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) b;}
\DoxyCodeLine{847    \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) c;}
\DoxyCodeLine{848 \}}
\DoxyCodeLine{849 }
\DoxyCodeLine{850 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *stbi\_write\_png\_to\_mem(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *pixels, \textcolor{keywordtype}{int} stride\_bytes, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} *out\_len)}
\DoxyCodeLine{851 \{}
\DoxyCodeLine{852    \textcolor{keywordtype}{int} ctype[5] = \{ -\/1, 0, 4, 2, 6 \};}
\DoxyCodeLine{853    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} sig[8] = \{ 137,80,78,71,13,10,26,10 \};}
\DoxyCodeLine{854    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *out,*o, *filt, *zlib;}
\DoxyCodeLine{855    \textcolor{keywordtype}{signed} \textcolor{keywordtype}{char} *line\_buffer;}
\DoxyCodeLine{856    \textcolor{keywordtype}{int} i,j,k,p,zlen;}
\DoxyCodeLine{857 }
\DoxyCodeLine{858    \textcolor{keywordflow}{if} (stride\_bytes == 0)}
\DoxyCodeLine{859       stride\_bytes = x * n;}
\DoxyCodeLine{860 }
\DoxyCodeLine{861    filt = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) STBIW\_MALLOC((x*n+1) * y); \textcolor{keywordflow}{if} (!filt) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{862    line\_buffer = (\textcolor{keywordtype}{signed} \textcolor{keywordtype}{char} *) STBIW\_MALLOC(x * n); \textcolor{keywordflow}{if} (!line\_buffer) \{ STBIW\_FREE(filt); \textcolor{keywordflow}{return} 0; \}}
\DoxyCodeLine{863    \textcolor{keywordflow}{for} (j=0; j < y; ++j) \{}
\DoxyCodeLine{864       \textcolor{keyword}{static} \textcolor{keywordtype}{int} mapping[] = \{ 0,1,2,3,4 \};}
\DoxyCodeLine{865       \textcolor{keyword}{static} \textcolor{keywordtype}{int} firstmap[] = \{ 0,1,0,5,6 \};}
\DoxyCodeLine{866       \textcolor{keywordtype}{int} *mymap = j ? mapping : firstmap;}
\DoxyCodeLine{867       \textcolor{keywordtype}{int} best = 0, bestval = 0x7fffffff;}
\DoxyCodeLine{868       \textcolor{keywordflow}{for} (p=0; p < 2; ++p) \{}
\DoxyCodeLine{869          \textcolor{keywordflow}{for} (k= p?best:0; k < 5; ++k) \{}
\DoxyCodeLine{870             \textcolor{keywordtype}{int} type = mymap[k],est=0;}
\DoxyCodeLine{871             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *z = pixels + stride\_bytes*j;}
\DoxyCodeLine{872             \textcolor{keywordflow}{for} (i=0; i < n; ++i)}
\DoxyCodeLine{873                \textcolor{keywordflow}{switch} (type) \{}
\DoxyCodeLine{874                   \textcolor{keywordflow}{case} 0: line\_buffer[i] = z[i]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{875                   \textcolor{keywordflow}{case} 1: line\_buffer[i] = z[i]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{876                   \textcolor{keywordflow}{case} 2: line\_buffer[i] = z[i] -\/ z[i-\/stride\_bytes]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{877                   \textcolor{keywordflow}{case} 3: line\_buffer[i] = z[i] -\/ (z[i-\/stride\_bytes]>>1); \textcolor{keywordflow}{break};}
\DoxyCodeLine{878                   \textcolor{keywordflow}{case} 4: line\_buffer[i] = (\textcolor{keywordtype}{signed} char) (z[i] -\/ stbiw\_\_paeth(0,z[i-\/stride\_bytes],0)); \textcolor{keywordflow}{break};}
\DoxyCodeLine{879                   \textcolor{keywordflow}{case} 5: line\_buffer[i] = z[i]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{880                   \textcolor{keywordflow}{case} 6: line\_buffer[i] = z[i]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{881                \}}
\DoxyCodeLine{882             \textcolor{keywordflow}{for} (i=n; i < x*n; ++i) \{}
\DoxyCodeLine{883                \textcolor{keywordflow}{switch} (type) \{}
\DoxyCodeLine{884                   \textcolor{keywordflow}{case} 0: line\_buffer[i] = z[i]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{885                   \textcolor{keywordflow}{case} 1: line\_buffer[i] = z[i] -\/ z[i-\/n]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{886                   \textcolor{keywordflow}{case} 2: line\_buffer[i] = z[i] -\/ z[i-\/stride\_bytes]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{887                   \textcolor{keywordflow}{case} 3: line\_buffer[i] = z[i] -\/ ((z[i-\/n] + z[i-\/stride\_bytes])>>1); \textcolor{keywordflow}{break};}
\DoxyCodeLine{888                   \textcolor{keywordflow}{case} 4: line\_buffer[i] = z[i] -\/ stbiw\_\_paeth(z[i-\/n], z[i-\/stride\_bytes], z[i-\/stride\_bytes-\/n]); \textcolor{keywordflow}{break};}
\DoxyCodeLine{889                   \textcolor{keywordflow}{case} 5: line\_buffer[i] = z[i] -\/ (z[i-\/n]>>1); \textcolor{keywordflow}{break};}
\DoxyCodeLine{890                   \textcolor{keywordflow}{case} 6: line\_buffer[i] = z[i] -\/ stbiw\_\_paeth(z[i-\/n], 0,0); \textcolor{keywordflow}{break};}
\DoxyCodeLine{891                \}}
\DoxyCodeLine{892             \}}
\DoxyCodeLine{893             \textcolor{keywordflow}{if} (p) \textcolor{keywordflow}{break};}
\DoxyCodeLine{894             \textcolor{keywordflow}{for} (i=0; i < x*n; ++i)}
\DoxyCodeLine{895                est += abs((\textcolor{keywordtype}{signed} \textcolor{keywordtype}{char}) line\_buffer[i]);}
\DoxyCodeLine{896             \textcolor{keywordflow}{if} (est < bestval) \{ bestval = est; best = k; \}}
\DoxyCodeLine{897          \}}
\DoxyCodeLine{898       \}}
\DoxyCodeLine{899       \textcolor{comment}{// when we get here, best contains the filter type, and line\_buffer contains the data}}
\DoxyCodeLine{900       filt[j*(x*n+1)] = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}) best;}
\DoxyCodeLine{901       STBIW\_MEMMOVE(filt+j*(x*n+1)+1, line\_buffer, x*n);}
\DoxyCodeLine{902    \}}
\DoxyCodeLine{903    STBIW\_FREE(line\_buffer);}
\DoxyCodeLine{904    zlib = stbi\_zlib\_compress(filt, y*( x*n+1), \&zlen, 8); \textcolor{comment}{// increase 8 to get smaller but use more memory}}
\DoxyCodeLine{905    STBIW\_FREE(filt);}
\DoxyCodeLine{906    \textcolor{keywordflow}{if} (!zlib) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{907 }
\DoxyCodeLine{908    \textcolor{comment}{// each tag requires 12 bytes of overhead}}
\DoxyCodeLine{909    out = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) STBIW\_MALLOC(8 + 12+13 + 12+zlen + 12);}
\DoxyCodeLine{910    \textcolor{keywordflow}{if} (!out) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{911    *out\_len = 8 + 12+13 + 12+zlen + 12;}
\DoxyCodeLine{912 }
\DoxyCodeLine{913    o=out;}
\DoxyCodeLine{914    STBIW\_MEMMOVE(o,sig,8); o+= 8;}
\DoxyCodeLine{915    stbiw\_\_wp32(o, 13); \textcolor{comment}{// header length}}
\DoxyCodeLine{916    stbiw\_\_wptag(o, \textcolor{stringliteral}{"{}IHDR"{}});}
\DoxyCodeLine{917    stbiw\_\_wp32(o, x);}
\DoxyCodeLine{918    stbiw\_\_wp32(o, y);}
\DoxyCodeLine{919    *o++ = 8;}
\DoxyCodeLine{920    *o++ = (\textcolor{keywordtype}{unsigned} char) ctype[n];}
\DoxyCodeLine{921    *o++ = 0;}
\DoxyCodeLine{922    *o++ = 0;}
\DoxyCodeLine{923    *o++ = 0;}
\DoxyCodeLine{924    stbiw\_\_wpcrc(\&o,13);}
\DoxyCodeLine{925 }
\DoxyCodeLine{926    stbiw\_\_wp32(o, zlen);}
\DoxyCodeLine{927    stbiw\_\_wptag(o, \textcolor{stringliteral}{"{}IDAT"{}});}
\DoxyCodeLine{928    STBIW\_MEMMOVE(o, zlib, zlen);}
\DoxyCodeLine{929    o += zlen;}
\DoxyCodeLine{930    STBIW\_FREE(zlib);}
\DoxyCodeLine{931    stbiw\_\_wpcrc(\&o, zlen);}
\DoxyCodeLine{932 }
\DoxyCodeLine{933    stbiw\_\_wp32(o,0);}
\DoxyCodeLine{934    stbiw\_\_wptag(o, \textcolor{stringliteral}{"{}IEND"{}});}
\DoxyCodeLine{935    stbiw\_\_wpcrc(\&o,0);}
\DoxyCodeLine{936 }
\DoxyCodeLine{937    STBIW\_ASSERT(o == out + *out\_len);}
\DoxyCodeLine{938 }
\DoxyCodeLine{939    \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{940 \}}
\DoxyCodeLine{941 }
\DoxyCodeLine{942 \textcolor{preprocessor}{\#ifndef STBI\_WRITE\_NO\_STDIO}}
\DoxyCodeLine{943 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a9c03e5171f6aea47fde6dafcf3249ccf}{stbi\_write\_png}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *filename, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} stride\_bytes)}
\DoxyCodeLine{944 \{}
\DoxyCodeLine{945    FILE *f;}
\DoxyCodeLine{946    \textcolor{keywordtype}{int} len;}
\DoxyCodeLine{947    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *png = stbi\_write\_png\_to\_mem((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) data, stride\_bytes, x, y, comp, \&len);}
\DoxyCodeLine{948    \textcolor{keywordflow}{if} (png == NULL) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{949    f = fopen(filename, \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{950    \textcolor{keywordflow}{if} (!f) \{ STBIW\_FREE(png); \textcolor{keywordflow}{return} 0; \}}
\DoxyCodeLine{951    fwrite(png, 1, len, f);}
\DoxyCodeLine{952    fclose(f);}
\DoxyCodeLine{953    STBIW\_FREE(png);}
\DoxyCodeLine{954    \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{955 \}}
\DoxyCodeLine{956 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{957 }
\DoxyCodeLine{958 \mbox{\hyperlink{stb__image__write_8h_a1d964457ebf7cc898b8cb14e66cbfaa8}{STBIWDEF}} \textcolor{keywordtype}{int} \mbox{\hyperlink{stb__image__write_8h_a72dcd18698d64c92082449912c39a4e5}{stbi\_write\_png\_to\_func}}(\mbox{\hyperlink{stb__image__write_8h_a2326fd2fd79095b9ef34695a0bda114f}{stbi\_write\_func}} *func, \textcolor{keywordtype}{void} *context, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} comp, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *data, \textcolor{keywordtype}{int} stride\_bytes)}
\DoxyCodeLine{959 \{}
\DoxyCodeLine{960    \textcolor{keywordtype}{int} len;}
\DoxyCodeLine{961    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *png = stbi\_write\_png\_to\_mem((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) data, stride\_bytes, x, y, comp, \&len);}
\DoxyCodeLine{962    \textcolor{keywordflow}{if} (png == NULL) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{963    func(context, png, len);}
\DoxyCodeLine{964    STBIW\_FREE(png);}
\DoxyCodeLine{965    \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{966 \}}
\DoxyCodeLine{967 }
\DoxyCodeLine{968 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// STB\_IMAGE\_WRITE\_IMPLEMENTATION}}
\DoxyCodeLine{969 }
\DoxyCodeLine{970 \textcolor{comment}{/* Revision history}}
\DoxyCodeLine{971 \textcolor{comment}{      1.00 (2015-\/09-\/14)}}
\DoxyCodeLine{972 \textcolor{comment}{             installable file IO function}}
\DoxyCodeLine{973 \textcolor{comment}{      0.99 (2015-\/09-\/13)}}
\DoxyCodeLine{974 \textcolor{comment}{             warning fixes; TGA rle support}}
\DoxyCodeLine{975 \textcolor{comment}{      0.98 (2015-\/04-\/08)}}
\DoxyCodeLine{976 \textcolor{comment}{             added STBIW\_MALLOC, STBIW\_ASSERT etc}}
\DoxyCodeLine{977 \textcolor{comment}{      0.97 (2015-\/01-\/18)}}
\DoxyCodeLine{978 \textcolor{comment}{             fixed HDR asserts, rewrote HDR rle logic}}
\DoxyCodeLine{979 \textcolor{comment}{      0.96 (2015-\/01-\/17)}}
\DoxyCodeLine{980 \textcolor{comment}{             add HDR output}}
\DoxyCodeLine{981 \textcolor{comment}{             fix monochrome BMP}}
\DoxyCodeLine{982 \textcolor{comment}{      0.95 (2014-\/08-\/17)}}
\DoxyCodeLine{983 \textcolor{comment}{               add monochrome TGA output}}
\DoxyCodeLine{984 \textcolor{comment}{      0.94 (2014-\/05-\/31)}}
\DoxyCodeLine{985 \textcolor{comment}{             rename private functions to avoid conflicts with stb\_image.h}}
\DoxyCodeLine{986 \textcolor{comment}{      0.93 (2014-\/05-\/27)}}
\DoxyCodeLine{987 \textcolor{comment}{             warning fixes}}
\DoxyCodeLine{988 \textcolor{comment}{      0.92 (2010-\/08-\/01)}}
\DoxyCodeLine{989 \textcolor{comment}{             casts to unsigned char to fix warnings}}
\DoxyCodeLine{990 \textcolor{comment}{      0.91 (2010-\/07-\/17)}}
\DoxyCodeLine{991 \textcolor{comment}{             first public release}}
\DoxyCodeLine{992 \textcolor{comment}{      0.90   first internal release}}
\DoxyCodeLine{993 \textcolor{comment}{*/}}

\end{DoxyCode}
